<!-- templates/create_exam.html -->
{% extends "layout.html" %}

{% block title %}Táº¡o Ä‘á» thi{% endblock %}

{% block content %}
<style>
  .exam-type-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin: 30px 0;
  }

  .exam-card {
    padding: 25px;
    border: 3px solid #ddd;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s;
    text-align: center;
    background: white;
  }

  .exam-card:hover {
    border-color: #00796b;
    background: #e0f2f1;
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0,121,107,0.2);
  }

  .exam-card.active {
    border-color: #00796b;
    background: #00796b;
    color: white;
  }

  .exam-icon {
    font-size: 48px;
    margin-bottom: 15px;
  }

  .exam-form {
    background: #f5f5f5;
    padding: 25px;
    border-radius: 10px;
    margin-top: 20px;
  }
  
  .exam-form:not(.active) {
    display: none;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
  }

  .form-group input,
  .form-group select,
  .form-group textarea {
    width: 100%;
    padding: 10px;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 14px;
  }

  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: #00796b;
  }

  .grading-method {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-top: 10px;
  }

  .grading-option {
    padding: 15px;
    border: 2px solid #ddd;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s;
  }

  .grading-option:hover {
    border-color: #00796b;
    background: #e0f2f1;
  }

  .grading-option.active {
    border-color: #00796b;
    background: #00796b;
    color: white;
  }

  .info-box {
    background: #fff3cd;
    border-left: 4px solid #ffc107;
    padding: 15px;
    margin: 15px 0;
    border-radius: 5px;
    font-size: 14px;
  }

  .criteria-box {
    background: #e3f2fd;
    border-left: 4px solid #2196f3;
    padding: 15px;
    margin: 15px 0;
    border-radius: 5px;
  }

  .criteria-box h4 {
    color: #1976d2;
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 15px;
  }

  .btn-submit {
    background: linear-gradient(135deg, #00796b 0%, #009688 100%);
    color: white;
    padding: 12px 30px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    width: 100%;
  }

  .btn-submit:hover {
    background: linear-gradient(135deg, #005a4d 0%, #00796b 100%);
    box-shadow: 0 5px 15px rgba(0,121,107,0.3);
  }

  /* STYLE CHO KHUNG FILE MáºªU */
  .sample-file-box {
    background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%);
    border: 2px solid #81c784;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 30px;
    text-align: center;
  }

  .sample-file-box h3 {
    color: #2e7d32;
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 18px;
  }

  .sample-file-box p {
    color: #666;
    font-size: 14px;
    margin-bottom: 15px;
  }

  .sample-download-btn {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 12px 25px;
    background: white;
    border: 2px solid #4caf50;
    border-radius: 8px;
    color: #2e7d32;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s;
  }

  .sample-download-btn:hover {
    background: #4caf50;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(76,175,80,0.3);
  }

  .sample-download-btn span {
    font-size: 24px;
  }
</style>

<h2>Táº O Äá»€ THI Má»šI</h2>

<!-- KHUNG DOWNLOAD FILE MáºªU -->
<div class="sample-file-box">
  <h3>ğŸ“¥ File Ä‘á» máº«u minh há»a</h3>
  <p>Táº£i vá» file máº«u Ä‘á»ƒ tham kháº£o Ä‘á»‹nh dáº¡ng trÆ°á»›c khi táº¡o Ä‘á» thi</p>
  <a href="https://docs.google.com/document/d/18uqjNDtnikyVAYhYX6GxNMTwnDSr0PnT/edit?usp=sharing&ouid=109388140720750358249&rtpof=true&sd=true" target="_blank" class="sample-download-btn">
    <span>ğŸ“„</span>
    <div style="text-align: left;">
      <strong>File máº«u Ä‘á»‹nh dáº¡ng Ä‘á» thi</strong><br>
      <small style="font-weight: normal; color: #666;">Word (.docx) - HÆ°á»›ng dáº«n chi tiáº¿t</small>
    </div>
  </a>
</div>

<div class="exam-type-cards">
  <div class="exam-card active" data-type="multiple_choice">
    <div class="exam-icon">ğŸ“</div>
    <h3>Tráº¯c nghiá»‡m</h3>
    <p style="font-size: 13px; color: #666;">Chá»‰ cÃ³ ABCD vÃ  ÄÃºng/Sai</p>
  </div>

  <div class="exam-card" data-type="mixed">
    <div class="exam-icon">ğŸ“‹</div>
    <h3>Há»—n há»£p</h3>
    <p style="font-size: 13px; color: #666;">ABCD + ÄÃºng/Sai + Tá»± luáº­n</p>
  </div>

  <div class="exam-card" data-type="essay">
    <div class="exam-icon">âœï¸</div>
    <h3>Tá»± luáº­n</h3>
    <p style="font-size: 13px; color: #666;">Chá»‰ cÃ³ cÃ¢u há»i tá»± luáº­n</p>
  </div>
</div>

<!-- FORM TRáº®C NGHIá»†M -->
<form id="form-multiple-choice" class="exam-form active" method="POST" enctype="multipart/form-data">
  <input type="hidden" name="exam_type" value="multiple_choice">
  
  <h3 style="color: #00796b; margin-bottom: 20px;">Cáº¥u hÃ¬nh Ä‘á» tráº¯c nghiá»‡m</h3>

  <div class="form-group">
    <label>TiÃªu Ä‘á» Ä‘á» thi:</label>
    <input type="text" name="title" required placeholder="VÃ­ dá»¥: Kiá»ƒm tra 15 phÃºt - Lá»‹ch sá»­ Lá»›p 10">
  </div>

  <div class="form-group">
    <label>PhÃ¢n loáº¡i lá»›p:</label>
    <select name="grade" required>
      <option value="">-- Chá»n lá»›p --</option>
      <option value="10">Lá»›p 10</option>
      <option value="11">Lá»›p 11</option>
      <option value="12">Lá»›p 12</option>
    </select>
  </div>

  <div class="form-group">
    <label>Thá»i gian lÃ m bÃ i (phÃºt):</label>
    <input type="number" name="duration" value="60" min="10" max="180" required>
  </div>

  <div class="form-group">
    <label>Upload file Word chá»©a ná»™i dung:</label>
    <input type="file" name="word_file" accept=".docx" required>
    <small style="color: #666;">File .docx chá»©a ná»™i dung Ä‘á»ƒ AI táº¡o cÃ¢u há»i</small>
  </div>

  <div class="form-group">
    <label>Sá»‘ cÃ¢u tráº¯c nghiá»‡m ABCD:</label>
    <input type="number" name="num_multiple" value="10" min="1" max="50" required>
  </div>

  <div class="form-group">
    <label>Sá»‘ cÃ¢u ÄÃºng/Sai (má»—i cÃ¢u 4 Ã½):</label>
    <input type="number" name="num_truefalse" value="5" min="1" max="20" required>
  </div>

  <div class="criteria-box">
    <h4>ğŸ¤– TiÃªu chÃ­ cháº¥m Ä‘iá»ƒm tá»•ng thá»ƒ (TÃ¹y chá»n)</h4>
    <div class="form-group" style="margin-bottom: 0;">
      <label>HÆ°á»›ng dáº«n cháº¥m cho AI:</label>
      <textarea name="general_grading_criteria" rows="4" placeholder="VÃ­ dá»¥:
- Tráº¯c nghiá»‡m: Chá»n Ä‘Ã¡p Ã¡n Ä‘Ãºng Ä‘Æ°á»£c Ä‘iá»ƒm Ä‘áº§y Ä‘á»§
- ÄÃºng/Sai: Ãp dá»¥ng phÆ°Æ¡ng phÃ¡p trá»« dáº§n
- YÃªu cáº§u há»c sinh pháº£i hiá»ƒu kiáº¿n thá»©c cÆ¡ báº£n"></textarea>
      <small style="color: #666;">AI sáº½ sá»­ dá»¥ng tiÃªu chÃ­ nÃ y Ä‘á»ƒ cháº¥m Ä‘iá»ƒm chÃ­nh xÃ¡c hÆ¡n</small>
    </div>
  </div>

  <div class="info-box">
    <strong>LÆ°u Ã½:</strong> AI sáº½ tá»± Ä‘á»™ng táº¡o cÃ¢u há»i dá»±a trÃªn ná»™i dung file Word báº¡n upload
  </div>

  <button type="submit" class="btn-submit">Táº¡o Ä‘á» thi</button>
</form>

<!-- FORM Há»–N Há»¢P -->
<form id="form-mixed" class="exam-form" method="POST" enctype="multipart/form-data">
  <input type="hidden" name="exam_type" value="mixed">
  
  <h3 style="color: #00796b; margin-bottom: 20px;">Cáº¥u hÃ¬nh Ä‘á» há»—n há»£p</h3>

  <div class="form-group">
    <label>TiÃªu Ä‘á» Ä‘á» thi:</label>
    <input type="text" name="title" placeholder="VÃ­ dá»¥: Kiá»ƒm tra há»c ká»³ - Lá»‹ch sá»­ Lá»›p 11">
  </div>

  <div class="form-group">
    <label>PhÃ¢n loáº¡i lá»›p:</label>
    <select name="grade">
      <option value="">-- Chá»n lá»›p --</option>
      <option value="10">Lá»›p 10</option>
      <option value="11">Lá»›p 11</option>
      <option value="12">Lá»›p 12</option>
    </select>
  </div>

  <div class="form-group">
    <label>Thá»i gian lÃ m bÃ i (phÃºt):</label>
    <input type="number" name="duration" value="90" min="30" max="180">
  </div>

  <div class="form-group">
    <label>Upload file Word chá»©a ná»™i dung:</label>
    <input type="file" name="word_file" accept=".docx">
    <small style="color: #666;">File .docx chá»©a ná»™i dung Ä‘á»ƒ AI táº¡o cÃ¢u há»i</small>
  </div>

  <div class="form-group">
    <label>Sá»‘ cÃ¢u tráº¯c nghiá»‡m ABCD:</label>
    <input type="number" name="num_multiple" value="5" min="0" max="30">
  </div>

  <div class="form-group">
    <label>Sá»‘ cÃ¢u ÄÃºng/Sai:</label>
    <input type="number" name="num_truefalse" value="3" min="0" max="15">
  </div>

  <div class="form-group">
    <label>Sá»‘ cÃ¢u Tá»± luáº­n:</label>
    <input type="number" name="num_essay" value="1" min="1" max="5" id="num_essay_mixed">
  </div>

  <div class="form-group">
    <label>PhÆ°Æ¡ng phÃ¡p cháº¥m Ä‘iá»ƒm ÄÃºng/Sai:</label>
    <div class="grading-method">
      <label class="grading-option active">
        <input type="radio" name="tf_grading_method" value="deduction" checked style="display: none;">
        <h4>Trá»« dáº§n</h4>
        <p style="font-size: 12px; margin-top: 8px;">
          Sai 1 cÃ¢u: -0.5 Ä‘iá»ƒm<br>
          Sai 2 cÃ¢u: -0.75 Ä‘iá»ƒm<br>
          Sai 3 cÃ¢u: chá»‰ cÃ²n 0.1 Ä‘iá»ƒm
        </p>
      </label>

      <label class="grading-option">
        <input type="radio" name="tf_grading_method" value="per_item" style="display: none;">
        <h4>Tá»«ng Ã½</h4>
        <p style="font-size: 12px; margin-top: 8px;">
          Má»—i Ã½ Ä‘Ãºng: +0.25 Ä‘iá»ƒm<br>
          Má»—i Ã½ sai: +0 Ä‘iá»ƒm<br>
          Tá»‘i Ä‘a 1 Ä‘iá»ƒm/cÃ¢u
        </p>
      </label>
    </div>
  </div>

  <div class="criteria-box">
    <h4>ğŸ¤– TiÃªu chÃ­ cháº¥m Ä‘iá»ƒm tá»•ng thá»ƒ</h4>
    <div class="form-group" style="margin-bottom: 0;">
      <label>HÆ°á»›ng dáº«n cháº¥m chung cho toÃ n bá»™ Ä‘á» thi:</label>
      <textarea name="general_grading_criteria" rows="4" placeholder="VÃ­ dá»¥:
- CÃ¢u tráº¯c nghiá»‡m vÃ  Ä‘Ãºng/sai: Tá»± Ä‘á»™ng cháº¥m
- Pháº§n tá»± luáº­n: YÃªu cáº§u tráº£ lá»i rÃµ rÃ ng, cÃ³ logic
- ÄÃ¡nh giÃ¡ tá»•ng há»£p kháº£ nÄƒng hiá»ƒu bÃ i vÃ  váº­n dá»¥ng kiáº¿n thá»©c"></textarea>
      <small style="color: #666;">AI sáº½ dÃ¹ng tiÃªu chÃ­ nÃ y Ä‘á»ƒ cháº¥m pháº§n tá»± luáº­n</small>
    </div>
  </div>

  <div id="essay-criteria-container" style="display: none;">
    <div class="criteria-box">
      <h4>ğŸ“ TiÃªu chÃ­ cháº¥m cho tá»«ng cÃ¢u tá»± luáº­n</h4>
      <p style="font-size: 13px; color: #666; margin-bottom: 15px;">
        AI sáº½ táº¡o cÃ¢u há»i tá»± luáº­n tá»« file Word. Sau khi táº¡o xong, báº¡n cÃ³ thá»ƒ chá»‰nh sá»­a tiÃªu chÃ­ tá»«ng cÃ¢u trong pháº§n xem Ä‘á».
      </p>
      <div class="info-box">
        <strong>ğŸ’¡ Máº¹o:</strong> Vá»›i Ä‘á» há»—n há»£p, AI sáº½ tá»± Ä‘á»™ng táº¡o tiÃªu chÃ­ cháº¥m cho tá»«ng cÃ¢u tá»± luáº­n. Báº¡n cÃ³ thá»ƒ Ä‘iá»u chá»‰nh sau khi Ä‘á» Ä‘Æ°á»£c táº¡o.
      </div>
    </div>
  </div>

  <div class="info-box">
    <strong>PhÃ¢n bá»• Ä‘iá»ƒm:</strong> Tráº¯c nghiá»‡m 40% + ÄÃºng/Sai 30% + Tá»± luáº­n 30%<br>
    <strong>LÆ°u Ã½:</strong> AI sáº½ tá»± Ä‘á»™ng cháº¥m pháº§n tá»± luáº­n ngay sau khi há»c sinh ná»™p bÃ i
  </div>

  <button type="submit" class="btn-submit">Táº¡o Ä‘á» thi</button>
</form>

<!-- FORM Tá»° LUáº¬N -->
<form id="form-essay" class="exam-form" method="POST">
  <input type="hidden" name="exam_type" value="essay">
  
  <h3 style="color: #00796b; margin-bottom: 20px;">Cáº¥u hÃ¬nh Ä‘á» tá»± luáº­n</h3>

  <div class="form-group">
    <label>TiÃªu Ä‘á» Ä‘á» thi:</label>
    <input type="text" name="title" placeholder="VÃ­ dá»¥: BÃ i táº­p lá»›n - Lá»‹ch sá»­ Lá»›p 12">
  </div>

  <div class="form-group">
    <label>PhÃ¢n loáº¡i lá»›p:</label>
    <select name="grade">
      <option value="">-- Chá»n lá»›p --</option>
      <option value="10">Lá»›p 10</option>
      <option value="11">Lá»›p 11</option>
      <option value="12">Lá»›p 12</option>
    </select>
  </div>

  <div class="form-group">
    <label>Thá»i gian lÃ m bÃ i (phÃºt):</label>
    <input type="number" name="duration" value="90" min="30" max="180">
  </div>

  <div class="form-group">
    <label>CÃ¢u há»i tá»± luáº­n:</label>
    <textarea name="essay_question" rows="4" placeholder="Nháº­p cÃ¢u há»i tá»± luáº­n..."></textarea>
  </div>

  <div class="criteria-box">
    <h4>ğŸ¤– TiÃªu chÃ­ cháº¥m Ä‘iá»ƒm chi tiáº¿t cho AI</h4>
    <div class="form-group" style="margin-bottom: 0;">
      <label>HÆ°á»›ng dáº«n cháº¥m cá»¥ thá»ƒ:</label>
      <textarea name="grading_criteria" rows="8" placeholder="VÃ­ dá»¥ CHI TIáº¾T:

TIÃŠU CHÃ CHáº¤M (Thang Ä‘iá»ƒm 10):
- Ã 1: NguyÃªn nhÃ¢n cá»§a sá»± kiá»‡n (2 Ä‘iá»ƒm)
  + NÃªu Ä‘Ãºng 2 nguyÃªn nhÃ¢n chÃ­nh: 2 Ä‘iá»ƒm
  + NÃªu Ä‘Ãºng 1 nguyÃªn nhÃ¢n: 1 Ä‘iá»ƒm
  
- Ã 2: Diá»…n biáº¿n cá»§a sá»± kiá»‡n (3 Ä‘iá»ƒm)
  + MÃ´ táº£ Ä‘áº§y Ä‘á»§ quÃ¡ trÃ¬nh: 3 Ä‘iá»ƒm
  + MÃ´ táº£ sÆ¡ lÆ°á»£c: 1.5 Ä‘iá»ƒm
  
- Ã 3: Ã nghÄ©a lá»‹ch sá»­ (3 Ä‘iá»ƒm)
  + PhÃ¢n tÃ­ch sÃ¢u sáº¯c: 3 Ä‘iá»ƒm
  + Chá»‰ nháº­n xÃ©t chung: 1.5 Ä‘iá»ƒm
  
- Ã 4: Káº¿t luáº­n vÃ  bÃ i há»c (2 Ä‘iá»ƒm)
  + Káº¿t luáº­n rÃµ rÃ ng, cÃ³ bÃ i há»c: 2 Ä‘iá»ƒm
  + Chá»‰ cÃ³ káº¿t luáº­n: 1 Ä‘iá»ƒm

LÆ¯U Ã CHáº¤M:
- BÃ i viáº¿t pháº£i cÃ³ logic, máº¡ch láº¡c
- KhÃ´ng sao chÃ©p nguyÃªn vÄƒn tá»« sÃ¡ch
- ÄÃ¡nh giÃ¡ cao náº¿u cÃ³ sá»± phÃ¢n tÃ­ch cÃ¡ nhÃ¢n"></textarea>
      <small style="color: #666;">
        <strong>Quan trá»ng:</strong> TiÃªu chÃ­ cÃ ng chi tiáº¿t, AI cháº¥m Ä‘iá»ƒm cÃ ng chÃ­nh xÃ¡c. 
        NÃªn phÃ¢n chia rÃµ tá»«ng Ã½ vÃ  quy Ä‘á»‹nh cá»¥ thá»ƒ sá»‘ Ä‘iá»ƒm cho tá»«ng má»©c Ä‘á»™.
      </small>
    </div>
  </div>

  <div class="criteria-box">
    <h4>ğŸ“‹ TiÃªu chÃ­ cháº¥m tá»•ng thá»ƒ (TÃ¹y chá»n)</h4>
    <div class="form-group" style="margin-bottom: 0;">
      <label>YÃªu cáº§u chung vá» bÃ i lÃ m:</label>
      <textarea name="general_grading_criteria" rows="3" placeholder="VÃ­ dá»¥:
- BÃ i lÃ m pháº£i cÃ³ Ä‘á»™ dÃ i tá»« 300-500 tá»«
- VÄƒn báº£n pháº£i máº¡ch láº¡c, rÃµ rÃ ng
- KhÃ´ng Ä‘Æ°á»£c sao chÃ©p tá»« nguá»“n khÃ¡c"></textarea>
    </div>
  </div>

  <div class="info-box">
    <strong>ğŸ¤– AI tá»± Ä‘á»™ng cháº¥m Ä‘iá»ƒm:</strong> Sau khi há»c sinh ná»™p bÃ i, AI sáº½ tá»± Ä‘á»™ng cháº¥m vÃ  Ä‘Æ°a ra:
    <ul style="margin: 10px 0 0 20px;">
      <li>Äiá»ƒm sá»‘ (thang 10)</li>
      <li>PhÃ¢n tÃ­ch Ä‘iá»ƒm máº¡nh</li>
      <li>Chá»‰ ra Ä‘iá»ƒm yáº¿u cáº§n cáº£i thiá»‡n</li>
      <li>Kiáº¿n thá»©c cÃ²n thiáº¿u</li>
      <li>Gá»£i Ã½ cá»¥ thá»ƒ Ä‘á»ƒ há»c tá»‘t hÆ¡n</li>
    </ul>
  </div>

  <button type="submit" class="btn-submit">Táº¡o Ä‘á» thi</button>
</form>

<p style="text-align: center; margin-top: 30px;">
  <a href="{{ url_for('dashboard_teacher') }}" style="color: #00796b; text-decoration: none; font-weight: 600;">â† Quay láº¡i trang quáº£n lÃ½</a>
</p>

<script>
document.addEventListener('DOMContentLoaded', function() {
  console.log('Script loaded');
  
  // Xá»­ lÃ½ click vÃ o exam card
  document.querySelectorAll('.exam-card').forEach(card => {
    card.addEventListener('click', function(e) {
      e.preventDefault();
      
      const type = this.getAttribute('data-type');
      console.log('Clicked:', type);
      
      // XÃ³a active tá»« táº¥t cáº£ cards
      document.querySelectorAll('.exam-card').forEach(c => {
        c.classList.remove('active');
      });
      
      // ThÃªm active cho card hiá»‡n táº¡i
      this.classList.add('active');
      
      // áº¨n táº¥t cáº£ forms
      document.querySelectorAll('.exam-form').forEach(form => {
        form.classList.remove('active');
      });
      
      // Hiá»ƒn thá»‹ form tÆ°Æ¡ng á»©ng
      const targetForm = document.getElementById('form-' + type);
      console.log('Target form:', targetForm);
      if (targetForm) {
        targetForm.classList.add('active');
        console.log('Form activated:', 'form-' + type);
      }
    });
  });
  
  // Xá»­ lÃ½ grading method
  document.querySelectorAll('.grading-option').forEach(option => {
    option.addEventListener('click', function(e) {
      e.preventDefault();
      
      this.closest('.grading-method').querySelectorAll('.grading-option').forEach(opt => {
        opt.classList.remove('active');
      });
      
      this.classList.add('active');
      
      const radio = this.querySelector('input[type="radio"]');
      if (radio) {
        radio.checked = true;
      }
    });
  });
  
  // Hiá»ƒn thá»‹/áº©n pháº§n tiÃªu chÃ­ tá»± luáº­n
  const numEssayInput = document.getElementById('num_essay_mixed');
  if (numEssayInput) {
    numEssayInput.addEventListener('change', function() {
      const container = document.getElementById('essay-criteria-container');
      if (parseInt(this.value) > 0) {
        container.style.display = 'block';
      } else {
        container.style.display = 'none';
      }
    });
    
    if (parseInt(numEssayInput.value) > 0) {
      document.getElementById('essay-criteria-container').style.display = 'block';
    }
  }
  
  // Log tráº¡ng thÃ¡i ban Ä‘áº§u
  console.log('Forms:', document.querySelectorAll('.exam-form'));
  console.log('Active form:', document.querySelector('.exam-form.active'));
});
</script>

{% endblock %}